<?php
declare(strict_types=1);

use GuzzleHttp\Client;
use Hawk\HawkiClientBackend\Exception\HawkiAppExceptionInterface;
use Hawk\HawkiClientBackend\HawkiClientBackend;

session_start();
if (empty($_SESSION['userId'])) {
    http_response_code(401);
    echo json_encode(['error' => 'Unauthorized']);
    exit;
}

if (empty($_POST['public_key'])) {
    http_response_code(400);
    echo json_encode(['error' => 'Public key is required']);
    exit;
}

$httpClient = new Client([
    'allow_redirects' => ['strict' => true],
    'verify' => false, // Disable SSL verification for local development
]);

$hawkiApp = new HawkiClientBackend(
    hawkiUrl: 'https://hawki-nginx',
    apiToken: '1|iEDTtHHwztrf1uue3mCVhcGVThfQseE7ixQ7zw6I3a27895f',
    privateKey: 'LS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tDQpNSUlKUXdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0NTMHdnZ2twQWdFQUFvSUNBUURKekw0dlJOaFVDU2NuDQpYWEhHeXBkS0pQTmRzdTFFN2tHcDJiWVlLSWhYQkRQUG91OStsamp6TkFoWjd0czJveFFuWXlla0pPTVBLYTA2DQpCQkxRT2M0dHNEd3dLdkNSWThxYi9NaGpiRXc4VXpNVmVFUE43cFBTeVExcDN3aEU4LzFkclpUblRITEl4NG84DQpLR0NDa2xTL2dBVUFiNlFBTkJzMkFZTDFLWmxlRDZhaUZzNlFlMHozWXpuL0dDbTNPNmRBUEJhL1o4T2k2WVlJDQpLWWZSMzFUeFZyc291ZW1QY0EzZXp3amhvOXAwQ3pRUTFpRFZUVkhEblIwbm5yOXZDMHF1SWJvbERVS0Z3MHdKDQpJdGVrNFJDRXhycnR0ZVE4R3hVQzlxc2dBVEY3YUR3ZmVUakZIK1dsTytheHlaOStENUduRkFobFpsdndoRmRkDQorVzQ2bjVaMzl4OGdGc2kxdi9FbEw0Yng3MHJzMGR3TE9UTGpOWlM0L2tFa1c5NnYydFF0SlM4RGxEMzBVZU9SDQpQVzBTZ3FUUktvNVZFVW43bkw2RjEvZEVPQktiRkF6YlpsUGhPbGMwV2FKZm8zR3U1bXIwZFgvSmVTOGxjTnFYDQpwRmhacTNqbm9GZXBnaFFxdHFkaFVJeXl3MVpaNnBEWEFxT0ZqdzdkUStYbFRrcldWb3MzOHJ6TkdCOEdwcTVtDQpOZitaQTlEaXRNOUxwbXg5b1ZMbDJYSlN1Q1E0SEd5UDgvU2dZWmRKSVNxcThRRTF1dGowL1QzTnlwbmgvcHQ4DQpITmJHNkdseUR3SHl1VjN4czU2TjdYWWtaQzNjbnozVFhnTTIvanZocnVvRnZFY0N4ZnJKalAvRWhtTWo0ZHZSDQpQcUhFdXhCQ212eUFPSnhPVThRRmRac0xaTnVKZXdJREFRQUJBb0lDQUJyS2RjMVhaSDVJOWlFWEdpTW0yUGhjDQorTStqRU9ELzNmUFdGWU5yamlqa21VUk5xMklHUU9xamZuV3N3bFJQU09rRWFaK0p6aU5BaUl1VlBZZUF4U0NkDQpCR3REVXN1Rk8yd3VIbm5QUjVKb0JxRFR1MGRuRHgrdGdDY05iSG1nWFlOeHAyZkxFY29hR1A0WGxqTXFNNFRMDQpxRE9yU1ZORmw2bmtnQ1d3TDNqNkRFaWtvbjZJQUJYYWllUHJWS1BMa0U3S0szTDBnYTAvNGkxMGtMV0tPQ3E2DQpOYXJES1N1RDJET1JENVYxUFd2K2podXJjZWNmbHJxbzdILzFacnVGVWtBcW9NaUpLWFc4dkh3blcxMjd0akpmDQp6VEtyTXB2UU5KL3FHTzlDSS9id1JiQjFWWURHS3FUSjA3eklEeHZ3cG9qNTh6WVRFQ01FVHQwSkNsdFBhSmhVDQpTK1BLSXJ2WDcwM21NeGxlTS9BYmpaZTNvMlB2WjhjNjlkeVpUY3RvWG85REM4NTZTRUY2aitwYjhLLzN5VkhoDQpWbURVclFLUjhId0c2MEJmTDJzNSs1Nm94dGduUlo4MVNXcTV1S2tka3hqVCtaeWtzUkhmRmI2WUlIbmVyZFA5DQpucHJRK3d2YjhvSFRSNmpobithQTYrRWF1M1pVSlRzb1RSZDR1K0x5b0d5OWNwQ2FuTXQzbEdXTXpaZWRMYncrDQpPNVRsbjBqWUNhTGd1WGlHcFlKNlppdDlZRmFSb1M3NTUwekxtamJsbWFBd1NtTlNuM1B3cEFZWHVjUXZ2T2o1DQp1M3VlYUQwWTRuTGZGVGNGQytmYmdPSVpZWFdsaTZ1enpmczRwUlFUYnU3YWZLdFdPMEIvK0hMM1ZqcDhobDFiDQoxWWxlY2xXZjBlY3gwNDluOG1yeEFvSUJBUURvcThWR0FlNVBkOURkVXZ5ek5neGdLLzVUUXJWemsvckJndVh6DQowLzFTaUtULzlXU3pGY2V5VTVveE1xNXlDSXI0Uk5GbUNVcWZGenp4SXJCNzhtWDAwcHpzYVhMazViQnZKQWFmDQpPTEsySXRnNXhteS8yT2djUnVka3lqVTJUVzdQNDdDcW83cCtRTEtSdG5iMTRWemk2RjRWL1JhSXZxZ25HcENnDQp2RnFXWGg4Z21XM3lwVFFtWS9xalFPVCthcmVheGE4UWlxQzlEWVA4V0kvOW5vL0JHOE9wbXlwNy9pSTRFaWNxDQpiRkFlU0pKQldTU1JnZ2x1d0xOZDFWSWVReGZIc3ZOazJLOVhjZWZZSnpOUUxEaHRZL2FXcUNaMTJWQmdSeWhSDQpVeUNwbEQrNTRnUXdDMS9WanovV1RiMVAvWS85c1IyTTVQcFZXTEdCakcvdnVHQmxBb0lCQVFEZUNKRDBBb2N0DQo3S3dzV3UxQWpmNFBBdnhubWpLVVU4R1c0ZjcwcHhiY01OMmtCc3FvaTRoNlFJMzQrV2hzMTlzWXpKbExGVk1MDQphWHBQaWV3YjJ0cm9zUWtOVE81Nk9wUURXUERkWE85ZmMwcWNsMlBMMHE2ejNDZ3pMNG1qa2FyM3BZYjNqYmdQDQp6bUJGUzYrRDFsRG1qa1AyN25nalFrZ09HRlBtQWtNNVI3dlBBQ1FXMGo3MmlUd01sTjc1eEVlOXRwWDZtZzZUDQo1STIyaHM0TEQ4dU1vUkU3YlY4cDR2ZGp5QnhITllNcTViTDJsY0tFUm8yYjRVRlpROVpQNmZTaDZ3Uno5OWphDQo4VE9wT2FmeHhSNzhFRVI2TTYrYWM0U05rbEdQdmdTVVphKzlGU1UyVURFLy96SjB0YWpvcnpGRDBuWHA5dUU0DQpSMkhqWWFSYm1uUmZBb0lCQVFEWHl4QlJTTk10RXpROVFZMnI3UkgzVkhZeDVLb0VBeGhMeDhyY3BSM0xJWDdmDQpBa3FlS2pJbmU1Q0QxcnlpZUxmallYaFF5WWRUSEN0aWZranUvRGVCcEtEMFJ5elBqUlJoVUNsd0hSYnJCRkJFDQo3WHJKU0RTbW5VQlpZNDJNeXE1ZTA0OTBCQnlnb2dLOFVGM3UyRkRkQnFUVWdnSVhXN1Q3WjVFQjh3K1ZiTUF6DQo3UGxqVmNPVFk2RC9MdDN6OVNoS3ZOUU1aSGFHUVBYTDRwdlJudkUzS2pnRG95ejVDUS9WcjBoeCtUa3BqU2RRDQp3b3UvQkxzWTVGSzNVWFV6S2dqeEoxREVsSSt6YTZxYStHaUlFQ3Raa2FBUHhPNisySW5LY2RTNzhIeFhxMjZiDQpTVHVYRDhXWGZaKzRkQ3VEOStsSFlyREVqMDU2UDZPS1FxVkMwVjlkQW9JQkFIOFM0QU1IUDE2bFNaVEpKV2dBDQozQnF6VnNua2tuWVp5WDRWTWRuTGwyWEdBZFBTbjBIL09jamVFV01oT3dhd001RHA2QUgwM21aMW82N0ovUHVrDQpNZzFpNVE5YnJGRUFIWjRjMVIyY0J0UFdKQ21pNjFiSDZYeSt6N01iemVaemhDbmY3bkxZQlRQbXBXcURlcHcxDQptRytibElKSzBTODh6QWhsRy85VDVDMXdSS2lnS0FkM3BObHNpWldaemxPY1pvTEpjT1RRTHUrdHF2MkFBWVNMDQpNYS8ycnVvWUdwTGFkMFFBVDA3aDdZUXJtbFZPT05tRGw2QlROeGRqbjlCMDBiR3AxQTZiRnQyWGxqMlA1ZktWDQpJcnFZaE5oN3BGRDlOQ3ZpUmhQQ2FOU1ZyaExGZTFxdVlzR0J5TnJLN1RUZXI0OWxjRjdMRVBNb3gzbGZkTFdJDQpuSGtDZ2dFQkFJeG50L3g2MXlTWXR6dm9valZtbWxSMENENkJXN2UycEs3K0VHb3poQ3g0Z2pPSnFqQWdqMXkyDQpBbyt0QmNSdHhjdlVnN25ZUnAvYUJTRTJjTmIwMFpieUZ5ZTNiSys0dGZIdkZEMGhtZldoRjJJdWV6YmtwcDNwDQpUbTQ2ZXRBSmRITGJYbVFhd3VrTGlnOG5NR044b0p5eGVscTRMbXhsTmRMeFg1VDJaNyszOHcwcTZ2eS9Gd2RzDQowZFEvVlNMODR5aDBHT1RkbTI1V3FxeDZXcG1nWE91ME0zQ2d0UzhqK1ZCMk1tUFJYTU4xTEFMcmN4T01rUndODQoxNjVkQzUwSXVVa0dUZm5ka3ZpQW1US2dxNDdTN3RwdGZEQUZZcWlJUmp2SU5FL0hKMDJUWnlkSHNac3hVYThSDQptVzI2bkt1S3QwaW9sOElLRzhObWgrZ2RLUU1ub053PQ0KLS0tLS1FTkQgUFJJVkFURSBLRVktLS0tLQ==|TUlJSlF3SUJBREFOQmdrcWhraUc5dzBCQVFFRkFBU0NDUzB3Z2drcEFnRUFBb0lDQVFESnpMNHZSTmhVQ1NjblhYSEd5cGRLSlBOZHN1MUU3a0dwMmJZWUtJaFhCRFBQb3U5K2xqanpOQWhaN3RzMm94UW5ZeWVrSk9NUEthMDZCQkxRT2M0dHNEd3dLdkNSWThxYi9NaGpiRXc4VXpNVmVFUE43cFBTeVExcDN3aEU4LzFkclpUblRITEl4NG84S0dDQ2tsUy9nQVVBYjZRQU5CczJBWUwxS1psZUQ2YWlGczZRZTB6M1l6bi9HQ20zTzZkQVBCYS9aOE9pNllZSUtZZlIzMVR4VnJzb3VlbVBjQTNlendqaG85cDBDelFRMWlEVlRWSERuUjBubnI5dkMwcXVJYm9sRFVLRncwd0pJdGVrNFJDRXhycnR0ZVE4R3hVQzlxc2dBVEY3YUR3ZmVUakZIK1dsTytheHlaOStENUduRkFobFpsdndoRmRkK1c0Nm41WjM5eDhnRnNpMXYvRWxMNGJ4NzByczBkd0xPVExqTlpTNC9rRWtXOTZ2MnRRdEpTOERsRDMwVWVPUlBXMFNncVRSS281VkVVbjduTDZGMS9kRU9CS2JGQXpiWmxQaE9sYzBXYUpmbzNHdTVtcjBkWC9KZVM4bGNOcVhwRmhacTNqbm9GZXBnaFFxdHFkaFVJeXl3MVpaNnBEWEFxT0ZqdzdkUStYbFRrcldWb3MzOHJ6TkdCOEdwcTVtTmYrWkE5RGl0TTlMcG14OW9WTGwyWEpTdUNRNEhHeVA4L1NnWVpkSklTcXE4UUUxdXRqMC9UM055cG5oL3B0OEhOYkc2R2x5RHdIeXVWM3hzNTZON1hZa1pDM2NuejNUWGdNMi9qdmhydW9GdkVjQ3hmckpqUC9FaG1NajRkdlJQcUhFdXhCQ212eUFPSnhPVThRRmRac0xaTnVKZXdJREFRQUJBb0lDQUJyS2RjMVhaSDVJOWlFWEdpTW0yUGhjK00rakVPRC8zZlBXRllOcmppamttVVJOcTJJR1FPcWpmbldzd2xSUFNPa0VhWitKemlOQWlJdVZQWWVBeFNDZEJHdERVc3VGTzJ3dUhublBSNUpvQnFEVHUwZG5EeCt0Z0NjTmJIbWdYWU54cDJmTEVjb2FHUDRYbGpNcU00VExxRE9yU1ZORmw2bmtnQ1d3TDNqNkRFaWtvbjZJQUJYYWllUHJWS1BMa0U3S0szTDBnYTAvNGkxMGtMV0tPQ3E2TmFyREtTdUQyRE9SRDVWMVBXditqaHVyY2VjZmxycW83SC8xWnJ1RlVrQXFvTWlKS1hXOHZId25XMTI3dGpKZnpUS3JNcHZRTkovcUdPOUNJL2J3UmJCMVZZREdLcVRKMDd6SUR4dndwb2o1OHpZVEVDTUVUdDBKQ2x0UGFKaFVTK1BLSXJ2WDcwM21NeGxlTS9BYmpaZTNvMlB2WjhjNjlkeVpUY3RvWG85REM4NTZTRUY2aitwYjhLLzN5VkhoVm1EVXJRS1I4SHdHNjBCZkwyczUrNTZveHRnblJaODFTV3E1dUtrZGt4alQrWnlrc1JIZkZiNllJSG5lcmRQOW5wclErd3ZiOG9IVFI2amhuK2FBNitFYXUzWlVKVHNvVFJkNHUrTHlvR3k5Y3BDYW5NdDNsR1dNelplZExidytPNVRsbjBqWUNhTGd1WGlHcFlKNlppdDlZRmFSb1M3NTUwekxtamJsbWFBd1NtTlNuM1B3cEFZWHVjUXZ2T2o1dTN1ZWFEMFk0bkxmRlRjRkMrZmJnT0laWVhXbGk2dXp6ZnM0cFJRVGJ1N2FmS3RXTzBCLytITDNWanA4aGwxYjFZbGVjbFdmMGVjeDA0OW44bXJ4QW9JQkFRRG9xOFZHQWU1UGQ5RGRVdnl6Tmd4Z0svNVRRclZ6ay9yQmd1WHowLzFTaUtULzlXU3pGY2V5VTVveE1xNXlDSXI0Uk5GbUNVcWZGenp4SXJCNzhtWDAwcHpzYVhMazViQnZKQWFmT0xLMkl0ZzV4bXkvMk9nY1J1ZGt5alUyVFc3UDQ3Q3FvN3ArUUxLUnRuYjE0VnppNkY0Vi9SYUl2cWduR3BDZ3ZGcVdYaDhnbVczeXBUUW1ZL3FqUU9UK2FyZWF4YThRaXFDOURZUDhXSS85bm8vQkc4T3BteXA3L2lJNEVpY3FiRkFlU0pKQldTU1JnZ2x1d0xOZDFWSWVReGZIc3ZOazJLOVhjZWZZSnpOUUxEaHRZL2FXcUNaMTJWQmdSeWhSVXlDcGxEKzU0Z1F3QzEvVmp6L1dUYjFQL1kvOXNSMk01UHBWV0xHQmpHL3Z1R0JsQW9JQkFRRGVDSkQwQW9jdDdLd3NXdTFBamY0UEF2eG5taktVVThHVzRmNzBweGJjTU4ya0JzcW9pNGg2UUkzNCtXaHMxOXNZekpsTEZWTUxhWHBQaWV3YjJ0cm9zUWtOVE81Nk9wUURXUERkWE85ZmMwcWNsMlBMMHE2ejNDZ3pMNG1qa2FyM3BZYjNqYmdQem1CRlM2K0QxbERtamtQMjduZ2pRa2dPR0ZQbUFrTTVSN3ZQQUNRVzBqNzJpVHdNbE43NXhFZTl0cFg2bWc2VDVJMjJoczRMRDh1TW9SRTdiVjhwNHZkanlCeEhOWU1xNWJMMmxjS0VSbzJiNFVGWlE5WlA2ZlNoNndSejk5amE4VE9wT2FmeHhSNzhFRVI2TTYrYWM0U05rbEdQdmdTVVphKzlGU1UyVURFLy96SjB0YWpvcnpGRDBuWHA5dUU0UjJIallhUmJtblJmQW9JQkFRRFh5eEJSU05NdEV6UTlRWTJyN1JIM1ZIWXg1S29FQXhoTHg4cmNwUjNMSVg3ZkFrcWVLakluZTVDRDFyeWllTGZqWVhoUXlZZFRIQ3RpZmtqdS9EZUJwS0QwUnl6UGpSUmhVQ2x3SFJickJGQkU3WHJKU0RTbW5VQlpZNDJNeXE1ZTA0OTBCQnlnb2dLOFVGM3UyRkRkQnFUVWdnSVhXN1Q3WjVFQjh3K1ZiTUF6N1BsalZjT1RZNkQvTHQzejlTaEt2TlFNWkhhR1FQWEw0cHZSbnZFM0tqZ0RveXo1Q1EvVnIwaHgrVGtwalNkUXdvdS9CTHNZNUZLM1VYVXpLZ2p4SjFERWxJK3phNnFhK0dpSUVDdFprYUFQeE82KzJJbktjZFM3OEh4WHEyNmJTVHVYRDhXWGZaKzRkQ3VEOStsSFlyREVqMDU2UDZPS1FxVkMwVjlkQW9JQkFIOFM0QU1IUDE2bFNaVEpKV2dBM0JxelZzbmtrbllaeVg0Vk1kbkxsMlhHQWRQU24wSC9PY2plRVdNaE93YXdNNURwNkFIMDNtWjFvNjdKL1B1a01nMWk1UTlickZFQUhaNGMxUjJjQnRQV0pDbWk2MWJINlh5K3o3TWJ6ZVp6aENuZjduTFlCVFBtcFdxRGVwdzFtRytibElKSzBTODh6QWhsRy85VDVDMXdSS2lnS0FkM3BObHNpWldaemxPY1pvTEpjT1RRTHUrdHF2MkFBWVNMTWEvMnJ1b1lHcExhZDBRQVQwN2g3WVFybWxWT09ObURsNkJUTnhkam45QjAwYkdwMUE2YkZ0MlhsajJQNWZLVklycVloTmg3cEZEOU5DdmlSaFBDYU5TVnJoTEZlMXF1WXNHQnlOcks3VFRlcjQ5bGNGN0xFUE1veDNsZmRMV0luSGtDZ2dFQkFJeG50L3g2MXlTWXR6dm9valZtbWxSMENENkJXN2UycEs3K0VHb3poQ3g0Z2pPSnFqQWdqMXkyQW8rdEJjUnR4Y3ZVZzduWVJwL2FCU0UyY05iMDBaYnlGeWUzYksrNHRmSHZGRDBobWZXaEYySXVlemJrcHAzcFRtNDZldEFKZEhMYlhtUWF3dWtMaWc4bk1HTjhvSnl4ZWxxNExteGxOZEx4WDVUMlo3KzM4dzBxNnZ5L0Z3ZHMwZFEvVlNMODR5aDBHT1RkbTI1V3FxeDZXcG1nWE91ME0zQ2d0UzhqK1ZCMk1tUFJYTU4xTEFMcmN4T01rUndOMTY1ZEM1MEl1VWtHVGZuZGt2aUFtVEtncTQ3Uzd0cHRmREFGWXFpSVJqdklORS9ISjAyVFp5ZEhzWnN4VWE4Um1XMjZuS3VLdDBpb2w4SUtHOE5taCtnZEtRTW5vTnc9',
    httpClient: $httpClient
);

try {
    echo json_encode($hawkiApp->getClientConfig(
        $_SESSION['userId'],
        $_POST['public_key']
    ), JSON_THROW_ON_ERROR);
} catch (HawkiAppExceptionInterface $e) {
    echo json_encode([
        'error' => $e->getMessage()
    ], JSON_THROW_ON_ERROR);
}
